// Auto-generated by webidl-codegen
// DO NOT EDIT - changes will be overwritten
//
// This file was generated from the source file with the same name.
// Class definitions have been enhanced with:
//   - Inherited methods from parent classes
//   - Property getters and setters
//   - Optimized field layouts

//! AbortController interface per WHATWG DOM Standard
//! Spec: https://dom.spec.whatwg.org/#interface-abortcontroller
//!
//! AbortController provides an abort() method that toggles the state of
//! a corresponding AbortSignal object.

const std = @import("std");
const webidl = @import("webidl");

const AbortSignal = @import("abort_signal").AbortSignal;
/// AbortController WebIDL interface
/// Spec: https://dom.spec.whatwg.org/#interface-abortcontroller
/// 
/// ```webidl
/// [Exposed=*]
/// interface AbortController {
/// constructor();
/// 
/// [SameObject] readonly attribute AbortSignal signal;
/// 
/// undefined abort(optional any reason);
/// };
/// ```
pub const AbortController = struct {
    const Self = @This();

    /// Allocator for memory management
    allocator: std.mem.Allocator,
    /// The associated AbortSignal object
    /// Spec: "An AbortController object has an associated signal (an AbortSignal object)"
    signalObj: *AbortSignal,

    /// Create a new AbortController
    /// Spec: https://dom.spec.whatwg.org/#dom-abortcontroller-abortcontroller
    /// 
    /// The new AbortController() constructor steps are:
    /// 1. Let signal be a new AbortSignal object.
    /// 2. Set this's signal to signal.
    pub fn init(allocator: std.mem.Allocator) !*Self {
        const self = try allocator.create(Self);
        errdefer allocator.destroy(self);

        // Step 1: Create a new AbortSignal (allocated on heap)
        const signal = try allocator.create(AbortSignal);
        errdefer allocator.destroy(signal);

        signal.* = try AbortSignal.init(allocator);
        errdefer signal.deinit();

        // Step 2: Set this's signal to signal
        self.* = .{
            .allocator = allocator,
            .signalObj = signal,
        };

        return self;
    }
    pub fn deinit(self: *Self) void {
        self.signalObj.deinit();
        self.allocator.destroy(self.signalObj);
        self.allocator.destroy(self);
    }
    /// Get the AbortSignal object associated with this controller
    /// Spec: https://dom.spec.whatwg.org/#dom-abortcontroller-signal
    /// 
    /// The signal getter steps are to return this's signal.
    pub fn get_signal(self: *const Self) *AbortSignal {
        return self.signalObj;
    }
    /// Abort the associated signal
    /// Spec: https://dom.spec.whatwg.org/#dom-abortcontroller-abort
    /// 
    /// The abort(reason) method steps are to signal abort on this with reason
    /// if it is given.
    pub fn call_abort(self: *Self, reason: ?webidl.JSValue) !void {
        // Spec: "To signal abort on an AbortController controller with an
        // optional reason, signal abort on controller's signal with reason
        // if it is given."

        try self.signalObj.signalAbort(reason);
    }
};

