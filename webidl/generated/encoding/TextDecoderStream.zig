// Auto-generated by webidl-codegen (AST/IR-based)
// DO NOT EDIT - changes will be overwritten
//
// This file was generated from the source file with the same name.
// Class definitions have been enhanced with:
//   - Inherited methods from parent classes
//   - Property getters and setters
//   - Optimized field layouts
//   - Automatic import resolution

const std = @import("std");
const webidl = @import("webidl");
const Allocator = @import("std.mem").Allocator;
const Text = @import("text").Text;
const std = @import("std");
const webidl = @import("webidl");

pub const TextDecoderStream = struct {

    // ========================================================================
    // Fields
    // ========================================================================

    encoding: []const u8,
    fatal: webidl.boolean,
    ignoreBOM: webidl.boolean,
    transform: *TransformStream,

    // ========================================================================
    // Methods
    // ========================================================================

    pub fn init(
        allocator: std.mem.Allocator,
        label: []const u8,
        options: TextDecoderOptions,
    ) !TextDecoderStream {

        // Get encoding from label
        const enc = encoding_mod.getEncoding(label) orelse {
            return error.InvalidEncoding;
        };

        // Reject replacement encoding
        if (std.mem.eql(u8, enc.whatwg_name, "replacement")) {
            return error.ReplacementEncoding;
        }

        // Create transform stream
        const transform = try allocator.create(TransformStream);
        errdefer allocator.destroy(transform);

        transform.* = try TransformStream.init(allocator, .{
            .transform = transformAlgorithm,
            .flush = flushAlgorithm,
        });

        // Create decoder instance
        const decoder = try allocator.create(Decoder);
        errdefer allocator.destroy(decoder);
        decoder.* = enc.newDecoder();

        return .{
            .encoding = enc.whatwg_name,
            .fatal = options.fatal,
            .ignoreBOM = options.ignoreBOM,
            .transform = transform,
            .allocator = allocator,
            .enc = enc,
            .decoder = decoder,
        };
    
    }

    pub fn deinit(self: *TextDecoderStream) void {

        self.allocator.destroy(self.decoder);
        self.transform.deinit();
        self.allocator.destroy(self.transform);
    
    }

    pub fn get_readable(self: *const GenericTransformStream) *ReadableStream {

        return self.transform.readableStream;
    
    }

    pub fn get_writable(self: *const GenericTransformStream) *WritableStream {

        return self.transform.writableStream;
    
    }

};


