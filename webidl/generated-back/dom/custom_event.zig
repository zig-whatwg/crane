// Auto-generated by webidl-codegen
// DO NOT EDIT - changes will be overwritten
//
// This file was generated from the source file with the same name.
// Class definitions have been enhanced with:
//   - Inherited methods from parent classes
//   - Property getters and setters
//   - Optimized field layouts

//! CustomEvent interface per WHATWG DOM Standard
//! Spec: https://dom.spec.whatwg.org/#interface-customevent
//!
//! CustomEvent allows applications to create events with custom data attached.

const std = @import("std");
const webidl = @import("webidl");

const Event = @import("event").Event;

/// CustomEventInit dictionary
/// Spec: https://dom.spec.whatwg.org/#dictdef-customeventinit
pub const CustomEventInit = struct {
    /// Event initialization (bubbles, cancelable, composed)
    /// Inherited from EventInit
    bubbles: bool = false,
    cancelable: bool = false,
    composed: bool = false,

    /// Custom detail data
    detail: ?webidl.JSValue = null,
};
/// CustomEvent WebIDL interface
/// Spec: https://dom.spec.whatwg.org/#interface-customevent
/// 
/// ```webidl
/// [Exposed=*]
/// interface CustomEvent : Event {
/// constructor(DOMString type, optional CustomEventInit eventInitDict = {});
/// 
/// readonly attribute any detail;
/// 
/// undefined initCustomEvent(DOMString type, optional boolean bubbles = false,
/// optional boolean cancelable = false, optional any detail = null);
/// };
/// ```
pub const CustomEvent = struct {
    const Self = @This();

    /// Allocator for memory management
    allocator: std.mem.Allocator,
    /// Event type (inherited from Event)
    eventType: []const u8,
    /// Event flags (inherited from Event)
    bubbles: bool,
    cancelable: bool,
    composed: bool,
    /// Event state (inherited from Event)
    isTrusted: bool,
    stopPropagationFlag: bool,
    stopImmediatePropagationFlag: bool,
    canceledFlag: bool,
    inPassiveListener: bool,
    /// Current target (inherited from Event)
    currentTarget: ?*anyopaque,
    /// Event phase (inherited from Event)
    eventPhase: u16,
    /// Timestamp (inherited from Event)
    timestamp: i64,
    /// Custom detail data attached to this event
    /// Spec: "CustomEvent objects have an associated detail (any)"
    detail: webidl.JSValue,

    /// Create a new CustomEvent
    /// Spec: https://dom.spec.whatwg.org/#dom-customevent-customevent
    /// 
    /// The new CustomEvent(type, eventInitDict) constructor steps are:
    /// 1. Let event be the result of running the initialize a CustomEvent algorithm
    /// 2. Set event's detail to eventInitDict's detail
    pub fn init(
        allocator: std.mem.Allocator,
        eventType: webidl.DOMString,
        eventInitDict: CustomEventInit,
    ) !CustomEvent {
        const type_copy = try allocator.dupe(u8, eventType);
        errdefer allocator.free(type_copy);

        return CustomEvent{
            .allocator = allocator,
            .eventType = type_copy,
            .bubbles = eventInitDict.bubbles,
            .cancelable = eventInitDict.cancelable,
            .composed = eventInitDict.composed,
            .isTrusted = false,
            .stopPropagationFlag = false,
            .stopImmediatePropagationFlag = false,
            .canceledFlag = false,
            .inPassiveListener = false,
            .currentTarget = null,
            .eventPhase = 0, // NONE
            .timestamp = std.time.milliTimestamp(),
            .detail = eventInitDict.detail orelse webidl.JSValue{ .null = {} },
        };
    }
    pub fn deinit(self: *Self) void {
        self.allocator.free(self.eventType);
    }

    /// Get the detail attached to this event
    /// Spec: https://dom.spec.whatwg.org/#dom-customevent-detail
    /// 
    /// The detail getter steps are to return this's detail.
    pub fn get_detail(self: *const Self) webidl.JSValue {
        return self.detail;
    }
    /// Initialize a CustomEvent (legacy)
    /// Spec: https://dom.spec.whatwg.org/#dom-customevent-initcustomevent
    /// 
    /// The initCustomEvent(type, bubbles, cancelable, detail) method steps are:
    /// 1. If this's dispatch flag is set, then return.
    /// 2. Initialize this with type, bubbles, and cancelable.
    /// 3. Set this's detail to detail.
    pub fn call_initCustomEvent(
        self: *Self,
        eventType: webidl.DOMString,
        bubbles: bool,
        cancelable: bool,
        detail: ?webidl.JSValue,
    ) !void {
        // Step 1: If dispatch flag is set, return
        // TODO: Check dispatch flag when event dispatching is implemented

        // Step 2: Reinitialize the event
        self.allocator.free(self.eventType);
        self.eventType = try self.allocator.dupe(u8, eventType);
        self.bubbles = bubbles;
        self.cancelable = cancelable;

        // Step 3: Set detail
        self.detail = detail orelse webidl.JSValue{ .null = {} };
    }
};

